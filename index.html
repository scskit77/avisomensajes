<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Confirmación de Bienestar</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffb300">
<style>
  :root {
    --amarillo: #ffeb3b;
    --naranja: #ff9800;
    --naranja-oscuro: #e65100;
    --fondo: #fff3e0;
    --sombra: rgba(0,0,0,0.15);
  }
  body {
    font-family: 'Segoe UI', Arial, sans-serif;
    background: var(--fondo);
    margin: 0;
    padding: 20px;
    color: #222;
  }
  h2 {
    text-align: center;
    background: linear-gradient(90deg, var(--naranja), var(--amarillo));
    padding: 10px;
    border-radius: 12px;
    color: #222;
    box-shadow: 0 2px 6px var(--sombra);
  }
  .bloque {
    background: #fff;
    border-left: 8px solid var(--naranja);
    border-radius: 12px;
    margin: 16px 0;
    padding: 16px;
    box-shadow: 0 3px 6px var(--sombra);
  }
  label {
    font-weight: 600;
    color: var(--naranja-oscuro);
    display: block;
    margin-top: 8px;
  }
  input, select {
    width: 100%;
    padding: 8px;
    margin-top: 4px;
    border: 1px solid #ccc;
    border-radius: 8px;
    box-sizing: border-box;
  }
  button {
    background: var(--naranja);
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 10px 16px;
    margin-top: 12px;
    cursor: pointer;
    font-weight: 600;
    box-shadow: 0 2px 4px var(--sombra);
    transition: background 0.2s;
  }
  button:hover { background: var(--naranja-oscuro); }
  .fila {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }
  @media(max-width:800px){
    .fila{grid-template-columns:1fr;}
  }
</style>
</head>
<body>
<h2>Confirmación de Bienestar</h2>

<!-- Agenda visible solo para añadir nuevos contactos -->
<div class="bloque">
  <h3>Agregar Contacto a la Agenda</h3>
  <label>Nombre</label>
  <input id="nombreAgenda" placeholder="Ej. Mamá">
  <label>Teléfono (ej. 346XXXXXXXX)</label>
  <input id="numeroAgenda" placeholder="Ej. 346XXXXXXXX">
  <button onclick="agregarContacto()">Guardar contacto</button>
</div>

<div class="bloque">
  <h3>Configurar Contactos</h3>
  <div class="fila">
    <div>
      <h4>Contacto 1</h4>
      <label>Seleccionar de la agenda</label>
      <select id="select1"></select>
      <label>Mensaje</label>
      <input id="mensaje1" value="Estoy bien">
      <label>Horas (HH:MM separadas por coma)</label>
      <input id="horas1" placeholder="09:00,14:00,21:00">
    </div>
    <div>
      <h4>Contacto 2</h4>
      <label>Seleccionar de la agenda</label>
      <select id="select2"></select>
      <label>Mensaje</label>
      <input id="mensaje2" value="Todo va bien">
      <label>Horas (HH:MM separadas por coma)</label>
      <input id="horas2" placeholder="10:00,15:00,22:00">
    </div>
  </div>
  <button onclick="guardarConfig()">Guardar Configuración</button>
</div>

<div class="bloque">
  <h3>Recordatorios</h3>
  <div id="avisos"></div>
</div>

<script>
let config = JSON.parse(localStorage.getItem("config") || "[]");
let agenda = JSON.parse(localStorage.getItem("agenda") || "[]");

function guardarConfig() {
  const contacto1 = document.getElementById("select1").value;
  const contacto2 = document.getElementById("select2").value;
  const mensaje1 = document.getElementById("mensaje1").value.trim();
  const mensaje2 = document.getElementById("mensaje2").value.trim();
  const horas1 = document.getElementById("horas1").value.split(",").map(h=>h.trim());
  const horas2 = document.getElementById("horas2").value.split(",").map(h=>h.trim());

  config = [];

  if (contacto1 && mensaje1 && horas1[0]) {
    horas1.forEach(hora=>{
      config.push({numero: contacto1, mensaje: mensaje1, hora});
    });
  }

  if (contacto2 && mensaje2 && horas2[0]) {
    horas2.forEach(hora=>{
      config.push({numero: contacto2, mensaje: mensaje2, hora});
    });
  }

  localStorage.setItem("config", JSON.stringify(config));
  mostrarConfig();
}

function mostrarConfig() {
  const avisos = document.getElementById("avisos");
  avisos.innerHTML = "";
  config.forEach(c => {
    const div = document.createElement("div");
    div.textContent = `A las ${c.hora} → ${c.numero}: "${c.mensaje}"`;
    avisos.appendChild(div);
  });
}

function revisarHoras() {
  const ahora = new Date();
  const horaActual = ahora.toTimeString().slice(0,5);
  config.forEach(c => {
    if (c.hora === horaActual) lanzarAviso(c);
  });
}

function lanzarAviso(c) {
  const url = `https://wa.me/${c.numero}?text=${encodeURIComponent(c.mensaje)}`;
  if (Notification.permission === "granted") {
    const noti = new Notification("Confirmación de Bienestar", {
      body: `Enviar a ${c.numero}: ${c.mensaje}`,
      icon: "icon-192.png"
    });
    noti.onclick = () => window.open(url, "_blank");
  } else {
    alert(`Es hora de avisar a ${c.numero}`);
    window.open(url, "_blank");
  }
}

// ---- Agenda (solo añadir contactos, sin mostrar lista) ----
function agregarContacto(){
  const nombre = document.getElementById("nombreAgenda").value.trim();
  const numero = document.getElementById("numeroAgenda").value.trim();
  if(!nombre || !numero){ alert("Faltan datos"); return; }
  agenda.push({nombre, numero});
  localStorage.setItem("agenda", JSON.stringify(agenda));
  document.getElementById("nombreAgenda").value="";
  document.getElementById("numeroAgenda").value="";
  cargarAgenda();
}

function cargarAgenda(){
  const sel1 = document.getElementById("select1");
  const sel2 = document.getElementById("select2");
  sel1.innerHTML="<option value=''>--Seleccionar--</option>";
  sel2.innerHTML="<option value=''>--Seleccionar--</option>";
  agenda.forEach(a=>{
    const o1=document.createElement("option");
    o1.value=a.numero;
    o1.textContent=a.nombre || a.numero;
    const o2=o1.cloneNode(true);
    sel1.appendChild(o1);
    sel2.appendChild(o2);
  });
}

if (Notification.permission !== "granted") Notification.requestPermission();
setInterval(revisarHoras, 60000);
if ('serviceWorker' in navigator) navigator.serviceWorker.register('service-worker.js');

cargarAgenda();
mostrarConfig();
</script>
</body>
</html>
